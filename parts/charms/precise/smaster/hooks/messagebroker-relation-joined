#!/usr/bin/env python

from charmhelpers.core.hookenv import unit_get, relations, relation_ids, relations_of_type, relation_types, relations_for_id
import requests
import json

address = unit_get("public-address")
relation = relations()
idMessageBroker = relation_ids()[0]
relationTypes = relation_types()
relationInfo = relations_for_id(idMessageBroker)
header = {"Content-Type": "application/json"}
payload = {"service": "kafka", "public-address": address, "relations": json.dumps(relation), "relationInfo": json.dumps(relationInfo), "idsRelat": idMessageBroker, "relationTypes": json.dumps(relationTypes), "test": relation["messagebroker"][idMessageBroker]["kubernetes-master/0"]["ingress-address"], "port": relation["messagebroker"][idMessageBroker]["kubernetes-master/0"]["port"]}
requests.post("https://test-api-ddlrzsfdsc.now.sh/", headers=header, data=json.dumps(payload))
